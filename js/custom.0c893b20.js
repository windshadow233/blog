function setInfo(o,t,n,e){if($(".welcome #local-ip").text(o),$(".welcome #city").text(t),$(".welcome #distance").text(n),!e){var a=new Date;a.setTime(a.getTime()+3e5);var i=JSON.stringify({ip:o,city:t,distance:n});$.cookie("locationInfo",i,{expires:a,path:"/"})}}function getDistance(o,t,n,e){const{sin:a,cos:i,asin:c,PI:r,hypot:s}=Math;let d=(o,t)=>(o*=r/180,{x:i(t*=r/180)*i(o),y:i(t)*a(o),z:a(t)}),l=d(o,t),p=d(n,e),f=2*c(s(l.x-p.x,l.y-p.y,l.z-p.z)/2)*6371;return Math.round(f)}function getIpInfo(){if(void 0!==$(".card-announcement").css("display")&&"none"!==$(".card-announcement").css("display")||!navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i))if($.cookie("locationInfo")){var o=JSON.parse($.cookie("locationInfo"));setInfo(o.ip,o.city,o.distance,!0)}else $.ajax({type:"get",url:"https://apis.map.qq.com/ws/location/v1/ip",data:{key:"SGYBZ-W6R6C-IHT2B-AH6JO-4DFLZ-IKF3H",output:"jsonp"},dataType:"jsonp",success:function(o){let{result:t={}}=o;if(t&&t.location){let o=getDistance(117.22901,31.82057,t.location.lng,t.location.lat);setInfo(t.ip,t.ad_info.province+t.ad_info.city+t.ad_info.district,o,!1)}}})}function download(o,t){var n=new XMLHttpRequest;n.open("GET",o,!0),n.responseType="blob",n.onload=function(o){var e=window.URL.createObjectURL(n.response),a=document.createElement("a");a.style.display="none",a.href=e,a.download=t,a.click(),window.URL.revokeObjectURL(e)},n.send()}function categoryBarRandomColor(){$("#categoryBar").length>0&&$("#categoryBar .category-list-item").each((function(){let o=Math.floor(151*Math.random())+50,t=Math.floor(151*Math.random())+50,n=Math.floor(151*Math.random())+50;$(this).css("background",`rgb(${o},${t},${n})`)}))}$(document).on("pjax:success",(function(o){void 0!==window.a2a&&a2a.init_all(),getIpInfo(),renderGitHubCalendar(),loadAbstract(),categoryBarRandomColor()})),$(document).on("pjax:error",(function(o){Snackbar.show({text:"似乎出了点问题，不妨刷新网页试试？",pos:"top-right",showAction:!1})})),$(document).on("click","a[download]",(function(o){o.preventDefault();download($(this).attr("href"),$(this).attr("download"))})),$(document).ready((function(){getIpInfo(),renderGitHubCalendar(),loadAbstract(),categoryBarRandomColor()}));