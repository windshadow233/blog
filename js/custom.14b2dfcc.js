function setInfo(e,t,o,n){if($(".welcome #local-ip").text(e),$(".welcome #city").text(t),$(".welcome #distance").text(o),!n){var a=new Date;a.setTime(a.getTime()+3e5);var c=JSON.stringify({ip:e,city:t,distance:o});$.cookie("locationInfo",c,{expires:a,path:"/"})}}function getDistance(e,t,o,n){const{sin:a,cos:c,asin:i,PI:r,hypot:s}=Math;let l=(e,t)=>(e*=r/180,{x:c(t*=r/180)*c(e),y:c(t)*a(e),z:a(t)}),d=l(e,t),u=l(o,n),f=2*i(s(d.x-u.x,d.y-u.y,d.z-u.z)/2)*6371;return Math.round(f)}function getIpInfo(){if(void 0!==$(".card-announcement").css("display")&&"none"!==$(".card-announcement").css("display")||!navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i))if($.cookie("locationInfo")){var e=JSON.parse($.cookie("locationInfo"));setInfo(e.ip,e.city,e.distance,!0)}else $.ajax({type:"get",url:"https://apis.map.qq.com/ws/location/v1/ip",data:{key:"SGYBZ-W6R6C-IHT2B-AH6JO-4DFLZ-IKF3H",output:"jsonp"},dataType:"jsonp",success:function(e){let{result:t={}}=e;if(t&&t.location){let e=getDistance(117.22901,31.82057,t.location.lng,t.location.lat);setInfo(t.ip,t.ad_info.province+t.ad_info.city+t.ad_info.district,e,!1)}}})}function download(e,t){var o=new XMLHttpRequest;o.open("GET",e,!0),o.responseType="blob",o.onload=function(e){var n=window.URL.createObjectURL(o.response),a=document.createElement("a");a.style.display="none",a.href=n,a.download=t,a.click(),window.URL.revokeObjectURL(n)},o.send()}function categoryBarRandomColor(){$("#categoryBar").length>0&&$("#categoryBar .category-list-item").each((function(){let e=Math.floor(151*Math.random())+50,t=Math.floor(151*Math.random())+50,o=Math.floor(151*Math.random())+50;$(this).css("background",`rgb(${e},${t},${o})`)}))}function loadAbstract(){if(!document.querySelector("#article-container"))return;let e;if(null!==(match=location.pathname.match(/^\/blog\/(\d+)\/?/))){e=match[1];try{document.querySelector(".st").remove()}catch(e){}var t=new XMLHttpRequest;t.open("GET",`/abstract/${e}?t=${(new Date).getTime()}`),t.send(),t.onreadystatechange=e=>{if(4==t.readyState){if(200==t.status)var o=t.responseText.replace(/<[^>]*>/g,"");else o="文章摘要遇到异常。";const e=document.querySelector("#ai-content"),n=o;!function t(o){if(o<n.length)e.innerHTML+=n[o],setTimeout(t.bind(this),50,++o);else{var a=document.createElement("style");a.className="st",a.innerText="#ai-content::after{content:''!important;}",document.body.appendChild(a)}}(0)}}}}$(document).keydown((function(e){(e.ctrlKey||e.metaKey)&&"f"===e.key&&(e.preventDefault(),$(".search").click())})),$(document).on("pjax:success",(function(e){void 0!==window.a2a&&a2a.init_all(),getIpInfo(),renderGitHubCalendar(),loadAbstract(),categoryBarRandomColor()})),$(document).on("pjax:error",(function(e){Snackbar.show({text:"似乎出了点问题，不妨刷新网页试试？",pos:"top-right",showAction:!1})})),$(document).on("click","a[download]",(function(e){e.preventDefault();download($(this).attr("href"),$(this).attr("download"))})),$(document).on("click",".DocSearch-Hit a",(function(e){e.preventDefault();var t=$(this).attr("href");pjax.loadUrl(t)})),$(document).ready((function(){getIpInfo(),renderGitHubCalendar(),loadAbstract(),categoryBarRandomColor()}));